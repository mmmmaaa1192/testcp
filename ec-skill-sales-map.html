<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECæ‹…å½“è€…ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ— Ã— å£²ã‚Šä¸Šã’æ§‹é€  å¯è¦–åŒ–</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        #sales-tree {
            min-height: 600px;
        }

        #skill-map {
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .connection-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .connection-panel h2 {
            color: white;
            border-bottom-color: white;
        }

        .node circle {
            cursor: pointer;
            stroke: #667eea;
            stroke-width: 3px;
        }

        .node text {
            font-size: 14px;
            font-weight: 500;
        }

        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
        }

        .node.selected circle {
            stroke: #f5576c;
            stroke-width: 4px;
            filter: drop-shadow(0 0 10px #f5576c);
        }

        .skill-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
        }

        .skill-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .skill-item.related {
            border-left-color: #f5576c;
            background: #fff5f7;
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .skill-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .skill-level {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .skill-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .related-sales {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .sales-tag {
            background: #e0e7ff;
            color: #4c51bf;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 300px;
        }

        .controls {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        #connection-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ ECæ‹…å½“è€…ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ— Ã— å£²ã‚Šä¸Šã’æ§‹é€ </h1>
            <p class="subtitle">ã‚¹ã‚­ãƒ«ã¨å£²ã‚Šä¸Šã’è¦ç´ ã®é–¢é€£æ€§ã‚’å¯è¦–åŒ–</p>
        </header>

        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“Š ECå£²ã‚Šä¸Šã’æ§‹é€ ãƒ„ãƒªãƒ¼</h2>
                <div id="sales-tree"></div>
            </div>

            <div class="panel">
                <h2>ğŸ’¡ ECæ‹…å½“è€…ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ—</h2>
                <div id="skill-map"></div>
            </div>

            <div class="panel connection-panel">
                <h2>ğŸ”— ã‚¹ã‚­ãƒ«ã¨å£²ã‚Šä¸Šã’è¦ç´ ã®é–¢é€£æ€§</h2>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ade80;"></div>
                        <span>é«˜å½±éŸ¿</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fbbf24;"></div>
                        <span>ä¸­å½±éŸ¿</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #60a5fa;"></div>
                        <span>ä½å½±éŸ¿</span>
                    </div>
                </div>
                <div id="connection-list"></div>
            </div>
        </div>

        <div class="controls">
            <button onclick="resetSelection()">é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="expandAll()">ã™ã¹ã¦å±•é–‹</button>
            <button onclick="collapseAll()">ã™ã¹ã¦æŠ˜ã‚ŠãŸãŸã‚€</button>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // ECå£²ã‚Šä¸Šã’æ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const salesData = {
            name: "ECå£²ä¸Š",
            value: "100%",
            description: "ç·åˆçš„ãªECå£²ä¸Š",
            children: [
                {
                    name: "é›†å®¢",
                    value: "è¨ªå•è€…æ•°",
                    description: "ã‚µã‚¤ãƒˆã¸ã®æµå…¥",
                    children: [
                        {
                            name: "SEO",
                            value: "è‡ªç„¶æ¤œç´¢",
                            description: "æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–"
                        },
                        {
                            name: "åºƒå‘Š",
                            value: "æœ‰æ–™åºƒå‘Š",
                            description: "ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤åºƒå‘Š",
                            children: [
                                { name: "ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°", value: "æ¤œç´¢é€£å‹•å‹", description: "Google/Yahooåºƒå‘Š" },
                                { name: "SNSåºƒå‘Š", value: "ã‚½ãƒ¼ã‚·ãƒ£ãƒ«", description: "Facebook/Instagramåºƒå‘Š" },
                                { name: "ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤", value: "ãƒãƒŠãƒ¼åºƒå‘Š", description: "GDN/YDA" }
                            ]
                        },
                        {
                            name: "SNS",
                            value: "ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢",
                            description: "SNSã‹ã‚‰ã®æµå…¥"
                        },
                        {
                            name: "ãƒ¡ãƒ¼ãƒ«",
                            value: "ãƒ¡ãƒ«ãƒã‚¬",
                            description: "æ—¢å­˜é¡§å®¢ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ"
                        }
                    ]
                },
                {
                    name: "è»¢æ›ç‡",
                    value: "CVR",
                    description: "è¨ªå•è€…ã®è³¼å…¥è»¢æ›",
                    children: [
                        {
                            name: "ã‚µã‚¤ãƒˆè¨­è¨ˆ",
                            value: "UX/UI",
                            description: "ä½¿ã„ã‚„ã™ã•ãƒ»è¦‹ã‚„ã™ã•",
                            children: [
                                { name: "ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³", value: "å°ç·šè¨­è¨ˆ", description: "å•†å“ã¸ã®èª˜å°" },
                                { name: "æ¤œç´¢æ©Ÿèƒ½", value: "å•†å“æ¤œç´¢", description: "å•†å“ã®è¦‹ã¤ã‘ã‚„ã™ã•" },
                                { name: "ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ", value: "ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–", description: "ã‚¹ãƒãƒ›æœ€é©åŒ–" }
                            ]
                        },
                        {
                            name: "å•†å“ãƒšãƒ¼ã‚¸",
                            value: "å•†å“è©³ç´°",
                            description: "å•†å“æƒ…å ±ã®å……å®Ÿåº¦",
                            children: [
                                { name: "å•†å“ç”»åƒ", value: "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«", description: "é«˜å“è³ªãªç”»åƒ" },
                                { name: "å•†å“èª¬æ˜", value: "ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°", description: "é­…åŠ›çš„ãªèª¬æ˜æ–‡" },
                                { name: "ãƒ¬ãƒ“ãƒ¥ãƒ¼", value: "å£ã‚³ãƒŸ", description: "é¡§å®¢ãƒ¬ãƒ“ãƒ¥ãƒ¼" }
                            ]
                        },
                        {
                            name: "æ±ºæ¸ˆãƒ—ãƒ­ã‚»ã‚¹",
                            value: "è³¼å…¥ãƒ•ãƒ­ãƒ¼",
                            description: "è³¼å…¥ã®ã—ã‚„ã™ã•",
                            children: [
                                { name: "ã‚«ãƒ¼ãƒˆ", value: "ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½", description: "åˆ†ã‹ã‚Šã‚„ã™ã„ã‚«ãƒ¼ãƒˆ" },
                                { name: "æ±ºæ¸ˆæ–¹æ³•", value: "æ”¯æ‰•ã„é¸æŠ", description: "å¤šæ§˜ãªæ±ºæ¸ˆæ‰‹æ®µ" },
                                { name: "å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ", value: "EFO", description: "å…¥åŠ›ã®ã—ã‚„ã™ã•" }
                            ]
                        }
                    ]
                },
                {
                    name: "å®¢å˜ä¾¡",
                    value: "AOV",
                    description: "1å›ã‚ãŸã‚Šã®è³¼å…¥é‡‘é¡",
                    children: [
                        {
                            name: "ã‚¢ãƒƒãƒ—ã‚»ãƒ«",
                            value: "ä¸Šä½å•†å“",
                            description: "ã‚ˆã‚Šé«˜é¡ãªå•†å“ã®ææ¡ˆ"
                        },
                        {
                            name: "ã‚¯ãƒ­ã‚¹ã‚»ãƒ«",
                            value: "é–¢é€£å•†å“",
                            description: "é–¢é€£å•†å“ã®ææ¡ˆ"
                        },
                        {
                            name: "ã‚»ãƒƒãƒˆè²©å£²",
                            value: "ãƒãƒ³ãƒ‰ãƒ«",
                            description: "ã¾ã¨ã‚è²·ã„ä¿ƒé€²"
                        },
                        {
                            name: "é€æ–™æ–½ç­–",
                            value: "é€æ–™ç„¡æ–™ãƒ©ã‚¤ãƒ³",
                            description: "é€æ–™ç„¡æ–™ã®é–¾å€¤è¨­å®š"
                        }
                    ]
                },
                {
                    name: "è³¼å…¥é »åº¦",
                    value: "ãƒªãƒ”ãƒ¼ãƒˆç‡",
                    description: "é¡§å®¢ã®å†è³¼å…¥",
                    children: [
                        {
                            name: "CRM",
                            value: "é¡§å®¢é–¢ä¿‚ç®¡ç†",
                            description: "é¡§å®¢ã¨ã®é–¢ä¿‚æ§‹ç¯‰",
                            children: [
                                { name: "ãƒ¡ãƒ«ãƒã‚¬", value: "ãƒ¡ãƒ¼ãƒ«é…ä¿¡", description: "å®šæœŸçš„ãªæƒ…å ±æä¾›" },
                                { name: "LINE", value: "LINEé…ä¿¡", description: "LINEã§ã®æ¥ç‚¹" },
                                { name: "ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡", value: "ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º", description: "å±æ€§åˆ¥é…ä¿¡" }
                            ]
                        },
                        {
                            name: "ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£",
                            value: "é¡§å®¢è‚²æˆ",
                            description: "ãƒ•ã‚¡ãƒ³åŒ–æ–½ç­–",
                            children: [
                                { name: "ãƒã‚¤ãƒ³ãƒˆ", value: "ãƒã‚¤ãƒ³ãƒˆåˆ¶åº¦", description: "ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒ" },
                                { name: "ä¼šå“¡ãƒ©ãƒ³ã‚¯", value: "ãƒ©ãƒ³ã‚¯åˆ¶åº¦", description: "ãƒ©ãƒ³ã‚¯åˆ¥ç‰¹å…¸" },
                                { name: "å®šæœŸè³¼å…¥", value: "ã‚µãƒ–ã‚¹ã‚¯", description: "å®šæœŸè³¼å…¥ä¿ƒé€²" }
                            ]
                        },
                        {
                            name: "ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹",
                            value: "è³¼å…¥å¾Œãƒ•ã‚©ãƒ­ãƒ¼",
                            description: "è³¼å…¥å¾Œã®æº€è¶³åº¦å‘ä¸Š"
                        }
                    ]
                }
            ]
        };

        // ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ—ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const skillsData = [
            {
                id: "skill1",
                name: "SEOãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
                category: "é›†å®¢",
                level: 5,
                description: "æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æˆ¦ç•¥",
                relatedSales: ["SEO", "é›†å®¢"],
                impact: "high"
            },
            {
                id: "skill2",
                name: "Webåºƒå‘Šé‹ç”¨",
                category: "é›†å®¢",
                level: 4,
                description: "ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãƒ»SNSåºƒå‘Šã®é‹ç”¨",
                relatedSales: ["åºƒå‘Š", "ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°", "SNSåºƒå‘Š", "ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤", "é›†å®¢"],
                impact: "high"
            },
            {
                id: "skill3",
                name: "SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
                category: "é›†å®¢",
                level: 4,
                description: "SNSã§ã®æƒ…å ±ç™ºä¿¡ã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é‹å–¶",
                relatedSales: ["SNS", "é›†å®¢"],
                impact: "medium"
            },
            {
                id: "skill4",
                name: "ãƒ¡ãƒ¼ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
                category: "é›†å®¢ãƒ»ãƒªãƒ”ãƒ¼ãƒˆ",
                level: 4,
                description: "ãƒ¡ãƒ«ãƒã‚¬ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ãƒ¡ãƒ¼ãƒ«é…ä¿¡",
                relatedSales: ["ãƒ¡ãƒ¼ãƒ«", "ãƒ¡ãƒ«ãƒã‚¬", "CRM", "é›†å®¢", "è³¼å…¥é »åº¦"],
                impact: "high"
            },
            {
                id: "skill5",
                name: "UI/UXè¨­è¨ˆ",
                category: "è»¢æ›",
                level: 3,
                description: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ»ä½“é¨“è¨­è¨ˆ",
                relatedSales: ["ã‚µã‚¤ãƒˆè¨­è¨ˆ", "ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³", "ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ", "è»¢æ›ç‡"],
                impact: "high"
            },
            {
                id: "skill6",
                name: "ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°",
                category: "è»¢æ›",
                level: 4,
                description: "é­…åŠ›çš„ãªå•†å“èª¬æ˜ãƒ»åºƒå‘Šæ–‡ä½œæˆ",
                relatedSales: ["å•†å“èª¬æ˜", "å•†å“ãƒšãƒ¼ã‚¸", "è»¢æ›ç‡"],
                impact: "high"
            },
            {
                id: "skill7",
                name: "æ’®å½±ãƒ»ç”»åƒç·¨é›†",
                category: "è»¢æ›",
                level: 3,
                description: "å•†å“ç”»åƒã®æ’®å½±ã¨ç·¨é›†",
                relatedSales: ["å•†å“ç”»åƒ", "å•†å“ãƒšãƒ¼ã‚¸", "è»¢æ›ç‡"],
                impact: "medium"
            },
            {
                id: "skill8",
                name: "ãƒ‡ãƒ¼ã‚¿åˆ†æ",
                category: "å…¨èˆ¬",
                level: 5,
                description: "Google Analyticsç­‰ã§ã®ãƒ‡ãƒ¼ã‚¿åˆ†æ",
                relatedSales: ["ECå£²ä¸Š", "é›†å®¢", "è»¢æ›ç‡", "å®¢å˜ä¾¡", "è³¼å…¥é »åº¦"],
                impact: "high"
            },
            {
                id: "skill9",
                name: "CRMãƒ»é¡§å®¢ç®¡ç†",
                category: "ãƒªãƒ”ãƒ¼ãƒˆ",
                level: 4,
                description: "é¡§å®¢ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡",
                relatedSales: ["CRM", "ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡", "è³¼å…¥é »åº¦"],
                impact: "high"
            },
            {
                id: "skill10",
                name: "ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ",
                category: "ãƒªãƒ”ãƒ¼ãƒˆ",
                level: 4,
                description: "å•ã„åˆã‚ã›å¯¾å¿œã¨é¡§å®¢æº€è¶³åº¦å‘ä¸Š",
                relatedSales: ["ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹", "è³¼å…¥é »åº¦", "è»¢æ›ç‡"],
                impact: "medium"
            },
            {
                id: "skill11",
                name: "ãƒãƒ¼ãƒãƒ£ãƒ³ãƒ€ã‚¤ã‚¸ãƒ³ã‚°",
                category: "å®¢å˜ä¾¡",
                level: 3,
                description: "å•†å“ä¼ç”»ãƒ»ä¾¡æ ¼æˆ¦ç•¥",
                relatedSales: ["ã‚¢ãƒƒãƒ—ã‚»ãƒ«", "ã‚¯ãƒ­ã‚¹ã‚»ãƒ«", "ã‚»ãƒƒãƒˆè²©å£²", "å®¢å˜ä¾¡"],
                impact: "high"
            },
            {
                id: "skill12",
                name: "åœ¨åº«ç®¡ç†ãƒ»ç‰©æµ",
                category: "é‹å–¶",
                level: 3,
                description: "åœ¨åº«ç®¡ç†ã¨é…é€æœ€é©åŒ–",
                relatedSales: ["é€æ–™æ–½ç­–", "ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹"],
                impact: "medium"
            },
            {
                id: "skill13",
                name: "HTML/CSS/JavaScript",
                category: "æŠ€è¡“",
                level: 3,
                description: "ã‚µã‚¤ãƒˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ»æ”¹å–„",
                relatedSales: ["ã‚µã‚¤ãƒˆè¨­è¨ˆ", "å•†å“ãƒšãƒ¼ã‚¸", "æ±ºæ¸ˆãƒ—ãƒ­ã‚»ã‚¹", "è»¢æ›ç‡"],
                impact: "medium"
            },
            {
                id: "skill14",
                name: "LPOãƒ»EFO",
                category: "è»¢æ›",
                level: 4,
                description: "ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ãƒ»ãƒ•ã‚©ãƒ¼ãƒ æœ€é©åŒ–",
                relatedSales: ["å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ", "æ±ºæ¸ˆãƒ—ãƒ­ã‚»ã‚¹", "è»¢æ›ç‡"],
                impact: "high"
            },
            {
                id: "skill15",
                name: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†",
                category: "å…¨èˆ¬",
                level: 4,
                description: "æ–½ç­–ã®ä¼ç”»ãƒ»å®Ÿè¡Œãƒ»ç®¡ç†",
                relatedSales: ["ECå£²ä¸Š"],
                impact: "low"
            }
        ];

        // ãƒ„ãƒªãƒ¼å›³ã®æç”»
        let selectedNode = null;
        let root, svg, gLink, gNode;

        function createSalesTree() {
            const width = document.getElementById('sales-tree').clientWidth;
            const height = 600;

            svg = d3.select("#sales-tree")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", "translate(40,20)");

            gLink = g.append("g").attr("class", "links");
            gNode = g.append("g").attr("class", "nodes");

            const treeLayout = d3.tree()
                .size([height - 40, width - 200]);

            root = d3.hierarchy(salesData);
            root.x0 = height / 2;
            root.y0 = 0;

            // åˆæœŸçŠ¶æ…‹ã§ã¯2éšå±¤ã¾ã§å±•é–‹
            root.children.forEach(collapse);
            
            function collapse(d) {
                if (d.children) {
                    d._children = d.children;
                    d._children.forEach(collapse);
                    d.children = null;
                }
            }

            update(root);

            function update(source) {
                const treeData = treeLayout(root);
                const nodes = treeData.descendants();
                const links = treeData.links();

                nodes.forEach(d => { d.y = d.depth * 180; });

                // ãƒãƒ¼ãƒ‰ã®æ›´æ–°
                const node = gNode.selectAll("g")
                    .data(nodes, d => d.id || (d.id = ++i));

                const nodeEnter = node.enter().append("g")
                    .attr("class", "node")
                    .attr("transform", d => `translate(${source.y0},${source.x0})`)
                    .on("click", clicked);

                nodeEnter.append("circle")
                    .attr("r", 8)
                    .style("fill", d => {
                        if (d._children) return "#764ba2";
                        return d.children ? "#667eea" : "#4ade80";
                    });

                nodeEnter.append("text")
                    .attr("dy", ".35em")
                    .attr("x", d => d.children || d._children ? -13 : 13)
                    .attr("text-anchor", d => d.children || d._children ? "end" : "start")
                    .text(d => d.data.name)
                    .style("fill-opacity", 1);

                const nodeUpdate = nodeEnter.merge(node);

                nodeUpdate.transition()
                    .duration(750)
                    .attr("transform", d => `translate(${d.y},${d.x})`);

                nodeUpdate.select("circle")
                    .style("fill", d => {
                        if (d._children) return "#764ba2";
                        return d.children ? "#667eea" : "#4ade80";
                    });

                const nodeExit = node.exit().transition()
                    .duration(750)
                    .attr("transform", d => `translate(${source.y},${source.x})`)
                    .remove();

                nodeExit.select("circle")
                    .attr("r", 1e-6);

                nodeExit.select("text")
                    .style("fill-opacity", 1e-6);

                // ãƒªãƒ³ã‚¯ã®æ›´æ–°
                const link = gLink.selectAll("path")
                    .data(links, d => d.target.id);

                const linkEnter = link.enter().insert("path", "g")
                    .attr("class", "link")
                    .attr("d", d => {
                        const o = {x: source.x0, y: source.y0};
                        return diagonal(o, o);
                    });

                const linkUpdate = linkEnter.merge(link);

                linkUpdate.transition()
                    .duration(750)
                    .attr("d", d => diagonal(d.source, d.target));

                link.exit().transition()
                    .duration(750)
                    .attr("d", d => {
                        const o = {x: source.x, y: source.y};
                        return diagonal(o, o);
                    })
                    .remove();

                nodes.forEach(d => {
                    d.x0 = d.x;
                    d.y0 = d.y;
                });

                // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
                nodeEnter.on("mouseover", function(event, d) {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.innerHTML = `
                        <strong>${d.data.name}</strong><br>
                        ${d.data.description}<br>
                        <em>${d.data.value}</em>
                    `;
                    tooltip.style.left = event.pageX + 10 + 'px';
                    tooltip.style.top = event.pageY - 30 + 'px';
                    tooltip.style.opacity = 1;
                })
                .on("mouseout", function() {
                    document.getElementById('tooltip').style.opacity = 0;
                });
            }

            function diagonal(s, d) {
                return `M ${s.y} ${s.x}
                        C ${(s.y + d.y) / 2} ${s.x},
                          ${(s.y + d.y) / 2} ${d.x},
                          ${d.y} ${d.x}`;
            }

            let i = 0;

            function clicked(event, d) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }

                // é¸æŠçŠ¶æ…‹ã®ç®¡ç†
                d3.selectAll(".node").classed("selected", false);
                d3.select(this).classed("selected", true);
                selectedNode = d.data.name;

                update(d);
                highlightRelatedSkills(d.data.name);
            }
        }

        // ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ—ã®æç”»
        function createSkillMap() {
            const container = document.getElementById('skill-map');
            container.innerHTML = '';

            const categories = [...new Set(skillsData.map(s => s.category))];
            
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.style.width = '100%';
                categoryDiv.style.marginBottom = '20px';
                
                const categoryHeader = document.createElement('h3');
                categoryHeader.textContent = category;
                categoryHeader.style.color = '#667eea';
                categoryHeader.style.marginBottom = '10px';
                categoryDiv.appendChild(categoryHeader);

                const categorySkills = skillsData.filter(s => s.category === category);
                
                categorySkills.forEach(skill => {
                    const skillDiv = document.createElement('div');
                    skillDiv.className = 'skill-item';
                    skillDiv.id = skill.id;
                    
                    const skillHeader = document.createElement('div');
                    skillHeader.className = 'skill-header';
                    
                    const skillName = document.createElement('div');
                    skillName.className = 'skill-name';
                    skillName.textContent = skill.name;
                    
                    const skillLevel = document.createElement('div');
                    skillLevel.className = 'skill-level';
                    skillLevel.textContent = `Lv ${skill.level}`;
                    skillLevel.style.background = 
                        skill.impact === 'high' ? '#4ade80' :
                        skill.impact === 'medium' ? '#fbbf24' : '#60a5fa';
                    
                    skillHeader.appendChild(skillName);
                    skillHeader.appendChild(skillLevel);
                    
                    const skillDesc = document.createElement('div');
                    skillDesc.className = 'skill-description';
                    skillDesc.textContent = skill.description;
                    
                    const relatedDiv = document.createElement('div');
                    relatedDiv.className = 'related-sales';
                    skill.relatedSales.forEach(sales => {
                        const tag = document.createElement('span');
                        tag.className = 'sales-tag';
                        tag.textContent = sales;
                        relatedDiv.appendChild(tag);
                    });
                    
                    skillDiv.appendChild(skillHeader);
                    skillDiv.appendChild(skillDesc);
                    skillDiv.appendChild(relatedDiv);
                    
                    skillDiv.addEventListener('click', () => {
                        document.querySelectorAll('.skill-item').forEach(el => {
                            el.classList.remove('related');
                        });
                        skillDiv.classList.add('related');
                        highlightRelatedSalesNodes(skill.relatedSales);
                    });
                    
                    categoryDiv.appendChild(skillDiv);
                });
                
                container.appendChild(categoryDiv);
            });
        }

        // é–¢é€£ã‚¹ã‚­ãƒ«ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightRelatedSkills(salesNode) {
            document.querySelectorAll('.skill-item').forEach(el => {
                el.classList.remove('related');
            });

            skillsData.forEach(skill => {
                if (skill.relatedSales.includes(salesNode)) {
                    document.getElementById(skill.id).classList.add('related');
                }
            });

            updateConnectionList(salesNode);
        }

        // é–¢é€£ã™ã‚‹å£²ä¸Šãƒãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆè¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
        function highlightRelatedSalesNodes(relatedSales) {
            // ã“ã“ã§ã¯æ—¢å­˜ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            d3.selectAll(".node").classed("selected", false);
            
            // é–¢é€£æƒ…å ±ã‚’è¡¨ç¤º
            updateConnectionListBySkill(relatedSales);
        }

        // é–¢é€£æ€§ãƒªã‚¹ãƒˆã®æ›´æ–°
        function updateConnectionList(salesNode) {
            const list = document.getElementById('connection-list');
            list.innerHTML = '';

            const relatedSkills = skillsData.filter(skill => 
                skill.relatedSales.includes(salesNode)
            );

            if (relatedSkills.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: white;">å£²ä¸Šè¦ç´ ã‚’é¸æŠã™ã‚‹ã¨ã€é–¢é€£ã™ã‚‹ã‚¹ã‚­ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>';
                return;
            }

            relatedSkills.forEach(skill => {
                const item = document.createElement('div');
                item.className = 'skill-item';
                
                const impactColor = 
                    skill.impact === 'high' ? '#4ade80' :
                    skill.impact === 'medium' ? '#fbbf24' : '#60a5fa';
                
                item.style.borderLeftColor = impactColor;
                
                item.innerHTML = `
                    <div class="skill-header">
                        <div class="skill-name">${skill.name}</div>
                        <div class="skill-level" style="background: ${impactColor}">
                            ${skill.impact === 'high' ? 'é«˜å½±éŸ¿' : skill.impact === 'medium' ? 'ä¸­å½±éŸ¿' : 'ä½å½±éŸ¿'}
                        </div>
                    </div>
                    <div class="skill-description">${skill.description}</div>
                `;
                
                list.appendChild(item);
            });
        }

        // ã‚¹ã‚­ãƒ«ã‹ã‚‰é–¢é€£æ€§ã‚’è¡¨ç¤º
        function updateConnectionListBySkill(relatedSales) {
            const list = document.getElementById('connection-list');
            list.innerHTML = '<h3 style="color: white; margin-bottom: 15px;">é–¢é€£ã™ã‚‹å£²ä¸Šè¦ç´ :</h3>';

            relatedSales.forEach(sales => {
                const item = document.createElement('div');
                item.className = 'skill-item';
                item.innerHTML = `
                    <div class="skill-name">${sales}</div>
                `;
                list.appendChild(item);
            });
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é–¢æ•°
        function resetSelection() {
            selectedNode = null;
            d3.selectAll(".node").classed("selected", false);
            document.querySelectorAll('.skill-item').forEach(el => {
                el.classList.remove('related');
            });
            document.getElementById('connection-list').innerHTML = 
                '<p style="text-align: center; color: white;">å£²ä¸Šè¦ç´ ã¾ãŸã¯ã‚¹ã‚­ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>';
        }

        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            update(root);
        }

        function collapseAll() {
            root.descendants().forEach(d => {
                if (d.children && d.depth > 0) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            update(root);
        }

        function update(source) {
            const treeData = d3.tree().size([600 - 40, document.getElementById('sales-tree').clientWidth - 200])(root);
            const nodes = treeData.descendants();
            const links = treeData.links();

            nodes.forEach(d => { d.y = d.depth * 180; });

            const node = gNode.selectAll("g")
                .data(nodes, d => d.id || (d.id = ++nodeIdCounter));

            const nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${source.y0},${source.x0})`)
                .on("click", clicked);

            nodeEnter.append("circle")
                .attr("r", 8)
                .style("fill", d => {
                    if (d._children) return "#764ba2";
                    return d.children ? "#667eea" : "#4ade80";
                });

            nodeEnter.append("text")
                .attr("dy", ".35em")
                .attr("x", d => d.children || d._children ? -13 : 13)
                .attr("text-anchor", d => d.children || d._children ? "end" : "start")
                .text(d => d.data.name)
                .style("fill-opacity", 1);

            const nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition()
                .duration(750)
                .attr("transform", d => `translate(${d.y},${d.x})`);

            nodeUpdate.select("circle")
                .style("fill", d => {
                    if (d._children) return "#764ba2";
                    return d.children ? "#667eea" : "#4ade80";
                });

            node.exit().transition()
                .duration(750)
                .attr("transform", d => `translate(${source.y},${source.x})`)
                .remove();

            const link = gLink.selectAll("path")
                .data(links, d => d.target.id);

            const linkEnter = link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("d", d => {
                    const o = {x: source.x0, y: source.y0};
                    return diagonal(o, o);
                });

            linkEnter.merge(link).transition()
                .duration(750)
                .attr("d", d => diagonal(d.source, d.target));

            link.exit().transition()
                .duration(750)
                .attr("d", d => {
                    const o = {x: source.x, y: source.y};
                    return diagonal(o, o);
                })
                .remove();

            nodes.forEach(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });

            nodeEnter.on("mouseover", function(event, d) {
                const tooltip = document.getElementById('tooltip');
                tooltip.innerHTML = `
                    <strong>${d.data.name}</strong><br>
                    ${d.data.description}<br>
                    <em>${d.data.value}</em>
                `;
                tooltip.style.left = event.pageX + 10 + 'px';
                tooltip.style.top = event.pageY - 30 + 'px';
                tooltip.style.opacity = 1;
            })
            .on("mouseout", function() {
                document.getElementById('tooltip').style.opacity = 0;
            });
        }

        function diagonal(s, d) {
            return `M ${s.y} ${s.x}
                    C ${(s.y + d.y) / 2} ${s.x},
                      ${(s.y + d.y) / 2} ${d.x},
                      ${d.y} ${d.x}`;
        }

        let nodeIdCounter = 0;

        function clicked(event, d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }

            d3.selectAll(".node").classed("selected", false);
            d3.select(this).classed("selected", true);
            selectedNode = d.data.name;

            update(d);
            highlightRelatedSkills(d.data.name);
        }

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            createSalesTree();
            createSkillMap();
            document.getElementById('connection-list').innerHTML = 
                '<p style="text-align: center; color: white;">å£²ä¸Šè¦ç´ ã¾ãŸã¯ã‚¹ã‚­ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>';
        });
    </script>
</body>
</html>
